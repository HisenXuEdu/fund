# æ—¥å†…å®æ—¶æ•°æ®æœåŠ¡æ–‡æ¡£

## ğŸ“Š åŠŸèƒ½æ¦‚è¿°

è‡ªåŠ¨é‡‡é›†æ‰€æœ‰åŸºé‡‘çš„æ—¥å†…å®æ—¶ä¼°å€¼æ•°æ®,æ”¯æŒæŸ¥è¯¢å•ä¸ªåŸºé‡‘ä¸€å¤©å†…çš„å‡€å€¼å˜åŒ–èµ°åŠ¿ã€‚

---

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

âœ… **è‡ªåŠ¨åŠ è½½åŸºé‡‘åˆ—è¡¨** - å¯åŠ¨æ—¶è‡ªåŠ¨ä»ä¸œæ–¹è´¢å¯Œè·å–æ‰€æœ‰åŸºé‡‘ä¿¡æ¯  
âœ… **å®šæ—¶é‡‡é›†æ•°æ®** - æ¯30ç§’é‡‡é›†ä¸€æ¬¡æ‰€æœ‰åŸºé‡‘çš„å®æ—¶ä¼°å€¼  
âœ… **äº¤æ˜“æ—¶é—´æ™ºèƒ½åˆ¤æ–­** - ä»…åœ¨äº¤æ˜“æ—¶é—´(å·¥ä½œæ—¥ 9:30-15:00)é‡‡é›†  
âœ… **å†…å­˜å­˜å‚¨** - æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­,æŸ¥è¯¢é€Ÿåº¦å¿«  
âœ… **è‡ªåŠ¨æ¸…ç†** - æ¯å¤©æ™šä¸Š21:00è‡ªåŠ¨æ¸…ç†å½“å¤©æ•°æ®  
âœ… **å¹¶å‘å®‰å…¨** - ä½¿ç”¨è¯»å†™é”ä¿è¯æ•°æ®ä¸€è‡´æ€§  

---

## ğŸ“¡ APIæ¥å£

### 1. è·å–åŸºé‡‘æ—¥å†…æ•°æ®

è·å–æŒ‡å®šåŸºé‡‘ä»å¼€ç›˜åˆ°å½“å‰æ—¶åˆ»çš„æ‰€æœ‰ä¼°å€¼æ•°æ®ç‚¹ã€‚

**è¯·æ±‚:**
```
GET /api/fund/intraday?code={åŸºé‡‘ä»£ç }
```

**å‚æ•°:**
- `code`: åŸºé‡‘ä»£ç (6ä½æ•°å­—)

**ç¤ºä¾‹:**
```bash
curl "http://localhost:8080/api/fund/intraday?code=001186"
```

**å“åº”:**
```json
{
  "code": "001186",
  "name": "å¯Œå›½æ–‡ä½“å¥åº·è‚¡ç¥¨A",
  "date": "2026-02-02",
  "data": [
    {
      "time": "09:35",
      "value": 3.011,
      "rate": 0.15
    },
    {
      "time": "10:05",
      "value": 3.015,
      "rate": 0.28
    },
    {
      "time": "10:35",
      "value": 3.008,
      "rate": 0.05
    }
  ]
}
```

**å­—æ®µè¯´æ˜:**
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | string | åŸºé‡‘ä»£ç  |
| name | string | åŸºé‡‘åç§° |
| date | string | æ—¥æœŸ(YYYY-MM-DD) |
| data | array | æ•°æ®ç‚¹æ•°ç»„ |
| data[].time | string | æ—¶é—´(HH:MM) |
| data[].value | number | ä¼°ç®—å‡€å€¼ |
| data[].rate | number | ä¼°ç®—æ¶¨è·Œå¹…(%) |

---

### 2. è·å–åŸºé‡‘åˆ—è¡¨

è·å–æ‰€æœ‰åŸºé‡‘çš„åŸºæœ¬ä¿¡æ¯åˆ—è¡¨,æ”¯æŒåˆ†é¡µã€‚

**è¯·æ±‚:**
```
GET /api/fund/list?page={é¡µç }&pageSize={æ¯é¡µæ•°é‡}
```

**å‚æ•°:**
- `page`: é¡µç ,é»˜è®¤1
- `pageSize`: æ¯é¡µæ•°é‡,é»˜è®¤100,æœ€å¤§1000

**ç¤ºä¾‹:**
```bash
# è·å–ç¬¬1é¡µ,æ¯é¡µ100æ¡
curl "http://localhost:8080/api/fund/list?page=1&pageSize=100"

# è·å–æ‰€æœ‰åŸºé‡‘(åˆ†é¡µè·å–)
curl "http://localhost:8080/api/fund/list?page=1&pageSize=1000"
```

**å“åº”:**
```json
{
  "total": 12580,
  "page": 1,
  "pageSize": 100,
  "data": [
    {
      "code": "000001",
      "name": "åå¤æˆé•¿æ··åˆ",
      "type": "æ··åˆå‹-åè‚¡"
    },
    {
      "code": "000002",
      "name": "åå¤æ°¸ç¦æ··åˆA",
      "type": "æ··åˆå‹-çµæ´»"
    }
  ]
}
```

---

### 3. è·å–æœåŠ¡çŠ¶æ€

æŸ¥çœ‹å®æ—¶æ•°æ®æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚

**è¯·æ±‚:**
```
GET /api/status
```

**ç¤ºä¾‹:**
```bash
curl "http://localhost:8080/api/status"
```

**å“åº”:**
```json
{
  "status": "running",
  "fundCount": 12580,
  "dataCount": 8345,
  "currentTime": "2026-02-02 14:30:15"
}
```

**å­—æ®µè¯´æ˜:**
- `status`: æœåŠ¡çŠ¶æ€
- `fundCount`: åŸºé‡‘æ€»æ•°
- `dataCount`: å·²é‡‡é›†æ•°æ®çš„åŸºé‡‘æ•°é‡
- `currentTime`: å½“å‰æ—¶é—´

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å¯åŠ¨æµç¨‹

```
1. æœåŠ¡å¯åŠ¨
   â†“
2. åŠ è½½æ‰€æœ‰åŸºé‡‘åˆ—è¡¨ (çº¦12000+åª)
   â†“
3. å¯åŠ¨å®šæ—¶é‡‡é›†ä»»åŠ¡ (æ¯30ç§’)
   â†“
4. åˆ¤æ–­æ˜¯å¦äº¤æ˜“æ—¶é—´
   â”œâ”€ æ˜¯ â†’ é‡‡é›†æ‰€æœ‰åŸºé‡‘å®æ—¶ä¼°å€¼
   â””â”€ å¦ â†’ è·³è¿‡æœ¬æ¬¡é‡‡é›†
   â†“
5. å­˜å‚¨åˆ°å†…å­˜
```

### æ•°æ®é‡‡é›†æ—¶é—´

- **é‡‡é›†é¢‘ç‡**: æ¯30ç§’ä¸€æ¬¡
- **äº¤æ˜“æ—¶é—´**: å·¥ä½œæ—¥ 9:30 - 15:00
- **æ•°æ®æ¸…ç†**: æ¯å¤© 21:00 è‡ªåŠ¨æ¸…ç†

### æ•°æ®å­˜å‚¨

```
å†…å­˜ç»“æ„:
map[åŸºé‡‘ä»£ç ]*FundIntradayData {
  "001186": {
    code: "001186",
    name: "å¯Œå›½æ–‡ä½“å¥åº·è‚¡ç¥¨A",
    date: "2026-02-02",
    data: [
      {time: "09:35", value: 3.011, rate: 0.15},
      {time: "10:05", value: 3.015, rate: 0.28},
      ...
    ]
  },
  "000001": {...},
  ...
}
```

---

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: å®æ—¶ç›‘æ§å¤§ç›˜

```javascript
// å®šæ—¶æŸ¥è¯¢æœåŠ¡çŠ¶æ€
setInterval(async () => {
  const status = await fetch('http://localhost:8080/api/status')
    .then(res => res.json());
  
  console.log(`å·²é‡‡é›† ${status.dataCount} åªåŸºé‡‘æ•°æ®`);
}, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥
```

### åœºæ™¯2: ç»˜åˆ¶åˆ†æ—¶å›¾

```javascript
// è·å–åŸºé‡‘æ—¥å†…èµ°åŠ¿
const response = await fetch('http://localhost:8080/api/fund/intraday?code=001186');
const data = await response.json();

// ä½¿ç”¨ ECharts ç»˜åˆ¶åˆ†æ—¶å›¾
const chart = echarts.init(document.getElementById('chart'));
const option = {
  title: { text: `${data.name} - åˆ†æ—¶èµ°åŠ¿` },
  xAxis: {
    type: 'category',
    data: data.data.map(item => item.time)
  },
  yAxis: { type: 'value' },
  series: [{
    data: data.data.map(item => item.value),
    type: 'line',
    smooth: true
  }]
};
chart.setOption(option);
```

### åœºæ™¯3: è®¡ç®—æ—¥å†…æ³¢åŠ¨

```python
import requests

# è·å–æ—¥å†…æ•°æ®
response = requests.get('http://localhost:8080/api/fund/intraday', 
                        params={'code': '001186'})
data = response.json()

# è®¡ç®—æœ€é«˜ã€æœ€ä½ã€æŒ¯å¹…
values = [point['value'] for point in data['data']]
high = max(values)
low = min(values)
amplitude = (high - low) / low * 100

print(f"æœ€é«˜: {high:.4f}")
print(f"æœ€ä½: {low:.4f}")
print(f"æŒ¯å¹…: {amplitude:.2f}%")
```

### åœºæ™¯4: æ‰¹é‡ç›‘æ§åŸºé‡‘

```python
import requests

# è·å–åŸºé‡‘åˆ—è¡¨
response = requests.get('http://localhost:8080/api/fund/list', 
                        params={'page': 1, 'pageSize': 100})
fund_list = response.json()['data']

# ç­›é€‰æˆ‘çš„å…³æ³¨åŸºé‡‘
my_funds = ['001186', '110022', '320007']

for fund_code in my_funds:
    # è·å–æ—¥å†…æ•°æ®
    intraday = requests.get(
        'http://localhost:8080/api/fund/intraday',
        params={'code': fund_code}
    ).json()
    
    if intraday['data']:
        latest = intraday['data'][-1]
        print(f"{intraday['name']}: {latest['value']} ({latest['rate']:+.2f}%)")
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å†…å­˜å ç”¨

- æ¯åªåŸºé‡‘æ¯å¤©çº¦é‡‡é›† **11ä¸ªæ•°æ®ç‚¹** (30ç§’é—´éš”,äº¤æ˜“æ—¶é—´5.5å°æ—¶)
- 12000åªåŸºé‡‘ Ã— 11ä¸ªç‚¹ Ã— æ¯ç‚¹çº¦100å­—èŠ‚ â‰ˆ **13MB**
- å†…å­˜å ç”¨ä¸å¤§,ä½†å»ºè®®å®šæœŸæ¸…ç†

### 2. ç½‘ç»œè¯·æ±‚

- æ¯30ç§’è¯·æ±‚12000+åªåŸºé‡‘
- æ¯æ¬¡é‡‡é›†æ€»è€—æ—¶çº¦ **2-3åˆ†é’Ÿ** (åŒ…å«10mså»¶è¿Ÿ)
- å»ºè®®ä½¿ç”¨ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ

### 3. æ•°æ®æ—¶æ•ˆæ€§

- æ•°æ®æ¥æºäºå¤©å¤©åŸºé‡‘ç½‘çš„**ä¼°ç®—å€¼**,éå®˜æ–¹å®æ—¶æ•°æ®
- ä¼°å€¼æ›´æ–°é¢‘ç‡çº¦1-3åˆ†é’Ÿ
- ä»…ä¾›å‚è€ƒ,ä¸ä½œä¸ºæŠ•èµ„ä¾æ®

### 4. éäº¤æ˜“æ—¶é—´

- éäº¤æ˜“æ—¶é—´(å‘¨æœ«ã€èŠ‚å‡æ—¥ã€éäº¤æ˜“æ—¶æ®µ)ä¸é‡‡é›†æ•°æ®
- æŸ¥è¯¢æ¥å£å¯èƒ½è¿”å›ç©ºæ•°æ®

### 5. æ•°æ®æ¸…ç†

- æ¯å¤©21:00è‡ªåŠ¨æ¸…ç†æ•°æ®
- æœåŠ¡é‡å¯åæ•°æ®ä¸¢å¤±(å†…å­˜å­˜å‚¨)
- å¦‚éœ€æŒä¹…åŒ–,å¯æ‰©å±•ä¸ºæ•°æ®åº“å­˜å‚¨

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### å½“å‰å®ç°

```go
// é¡ºåºé‡‡é›†,æ¯ä¸ªåŸºé‡‘é—´éš”10ms
for _, fund := range fundList {
    realtime, _ := fetchRealtimeEstimate(fund.Code)
    // å­˜å‚¨æ•°æ®
    time.Sleep(10 * time.Millisecond)
}
```

### ä¼˜åŒ–æ–¹æ¡ˆ1: å¹¶å‘é‡‡é›†

```go
// ä½¿ç”¨åç¨‹æ± å¹¶å‘é‡‡é›†,æå‡é€Ÿåº¦
var wg sync.WaitGroup
semaphore := make(chan struct{}, 100) // é™åˆ¶å¹¶å‘æ•°

for _, fund := range fundList {
    wg.Add(1)
    go func(f model.FundBasicInfo) {
        defer wg.Done()
        semaphore <- struct{}{}
        defer func() { <-semaphore }()
        
        realtime, _ := fetchRealtimeEstimate(f.Code)
        // å­˜å‚¨æ•°æ®
    }(fund)
}
wg.Wait()
```

### ä¼˜åŒ–æ–¹æ¡ˆ2: æŒ‰éœ€é‡‡é›†

```go
// åªé‡‡é›†ç”¨æˆ·å…³æ³¨çš„åŸºé‡‘,å‡å°‘è¯·æ±‚é‡
type IntradayService struct {
    watchList []string // å…³æ³¨åˆ—è¡¨
}

func (s *IntradayService) AddToWatchList(fundCode string) {
    // æ·»åŠ åˆ°å…³æ³¨åˆ—è¡¨
}

func (s *IntradayService) collectIntradayData() {
    // åªé‡‡é›†å…³æ³¨åˆ—è¡¨çš„åŸºé‡‘
    for _, code := range s.watchList {
        // é‡‡é›†æ•°æ®
    }
}
```

### ä¼˜åŒ–æ–¹æ¡ˆ3: æ•°æ®åº“æŒä¹…åŒ–

```go
// ä½¿ç”¨SQLiteæˆ–Rediså­˜å‚¨æ•°æ®
// ä¼˜ç‚¹: æ•°æ®æŒä¹…åŒ–,æœåŠ¡é‡å¯ä¸ä¸¢å¤±
// ç¼ºç‚¹: æŸ¥è¯¢é€Ÿåº¦ç¨æ…¢

import "database/sql"

func (s *IntradayService) saveToDatabase(data *model.FundIntradayData) {
    // ä¿å­˜åˆ°æ•°æ®åº“
    db.Exec("INSERT INTO intraday_data ...")
}
```

---

## ğŸš¦ æœåŠ¡ç›‘æ§

### å¯åŠ¨æ—¥å¿—ç¤ºä¾‹

```
ğŸ”„ æ­£åœ¨åŠ è½½åŸºé‡‘åˆ—è¡¨...
âœ… æˆåŠŸåŠ è½½ 12580 åªåŸºé‡‘
ğŸš€ æ—¥å†…å®æ—¶æ•°æ®æœåŠ¡å·²å¯åŠ¨
ğŸ“Š å¼€å§‹é‡‡é›†å®æ—¶æ•°æ® [09:35]
âœ… é‡‡é›†å®Œæˆ: æˆåŠŸ 12580, å¤±è´¥ 0
ğŸ“Š å¼€å§‹é‡‡é›†å®æ—¶æ•°æ® [10:05]
âœ… é‡‡é›†å®Œæˆ: æˆåŠŸ 12580, å¤±è´¥ 0
...
ğŸ—‘ï¸  å·²æ¸…ç†å½“å¤©æ•°æ®,å…± 12580 åªåŸºé‡‘
```

### æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl http://localhost:8080/api/status

# æŸ¥çœ‹åŸºé‡‘æ€»æ•°
curl http://localhost:8080/api/fund/list | jq '.total'

# æŸ¥çœ‹æŸåªåŸºé‡‘çš„æ•°æ®ç‚¹æ•°é‡
curl http://localhost:8080/api/fund/intraday?code=001186 | jq '.data | length'
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ€»è§ˆ](../README.md)
- [èµ°åŠ¿æ¥å£æ–‡æ¡£](./èµ°åŠ¿æ¥å£æ–‡æ¡£.md)
- [ä½¿ç”¨ç¤ºä¾‹](./ä½¿ç”¨ç¤ºä¾‹.md)

---

**æœ€åæ›´æ–°**: 2026-02-02
