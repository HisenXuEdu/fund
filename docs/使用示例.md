# åŸºé‡‘èµ°åŠ¿æ¥å£ä½¿ç”¨ç¤ºä¾‹

æœ¬æ–‡æ¡£æä¾›åŸºé‡‘èµ°åŠ¿APIçš„å®é™…ä½¿ç”¨ç¤ºä¾‹ã€‚

---

## ğŸ“Š å‰ç«¯ç»˜åˆ¶å›¾è¡¨ç¤ºä¾‹

### ä½¿ç”¨ ECharts

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>åŸºé‡‘å‡€å€¼èµ°åŠ¿å›¾</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #chart { width: 100%; height: 500px; }
        .controls { margin-bottom: 20px; }
        select, input { padding: 8px; margin-right: 10px; }
        button { padding: 8px 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>åŸºé‡‘å‡€å€¼èµ°åŠ¿æŸ¥è¯¢</h1>
    
    <div class="controls">
        <input type="text" id="fundCode" placeholder="åŸºé‡‘ä»£ç " value="001186">
        <select id="period">
            <option value="week">æœ€è¿‘ä¸€å‘¨</option>
            <option value="month" selected>æœ€è¿‘ä¸€ä¸ªæœˆ</option>
            <option value="quarter">æœ€è¿‘ä¸€å­£åº¦</option>
            <option value="half_year">æœ€è¿‘åŠå¹´</option>
            <option value="year">æœ€è¿‘ä¸€å¹´</option>
            <option value="three_years">æœ€è¿‘ä¸‰å¹´</option>
            <option value="all">å…¨éƒ¨å†å²</option>
        </select>
        <button onclick="loadChart()">æŸ¥è¯¢</button>
    </div>
    
    <div id="chart"></div>
    
    <script>
        const chart = echarts.init(document.getElementById('chart'));
        
        async function loadChart() {
            const fundCode = document.getElementById('fundCode').value;
            const period = document.getElementById('period').value;
            
            try {
                // è·å–èµ°åŠ¿æ•°æ®
                const response = await fetch(
                    `http://localhost:8080/api/fund/trend?code=${fundCode}&period=${period}`
                );
                const data = await response.json();
                
                if (data.error) {
                    alert('é”™è¯¯: ' + data.error);
                    return;
                }
                
                // è®¡ç®—æ”¶ç›Šç‡
                const firstValue = data.data[0].value;
                const lastValue = data.data[data.data.length - 1].value;
                const returnRate = ((lastValue - firstValue) / firstValue * 100).toFixed(2);
                
                // é…ç½®å›¾è¡¨
                const option = {
                    title: {
                        text: `${data.name} (${data.code})`,
                        subtext: `æ”¶ç›Šç‡: ${returnRate}%`,
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        formatter: function(params) {
                            const point = params[0];
                            return `${point.axisValue}<br/>å‡€å€¼: ${point.value}`;
                        }
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: data.data.map(item => item.date),
                        boundaryGap: false
                    },
                    yAxis: {
                        type: 'value',
                        scale: true
                    },
                    series: [{
                        name: 'å‡€å€¼',
                        type: 'line',
                        data: data.data.map(item => item.value),
                        smooth: true,
                        lineStyle: {
                            width: 2,
                            color: '#5470c6'
                        },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(84, 112, 198, 0.3)' },
                                    { offset: 1, color: 'rgba(84, 112, 198, 0)' }
                                ]
                            }
                        }
                    }]
                };
                
                chart.setOption(option);
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æŸ¥è¯¢
        loadChart();
        
        // å“åº”å¼è°ƒæ•´
        window.addEventListener('resize', () => {
            chart.resize();
        });
    </script>
</body>
</html>
```

---

## ğŸ Python æ•°æ®åˆ†æç¤ºä¾‹

### ä½¿ç”¨ Pandas + Matplotlib

```python
import requests
import pandas as pd
import matplotlib.pyplot as plt
from datetime import datetime

# é…ç½®ä¸­æ–‡å­—ä½“(æ ¹æ®ç³»ç»Ÿè°ƒæ•´)
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'SimHei']
plt.rcParams['axes.unicode_minus'] = False

def fetch_fund_trend(fund_code, period='month'):
    """è·å–åŸºé‡‘èµ°åŠ¿æ•°æ®"""
    url = 'http://localhost:8080/api/fund/trend'
    params = {'code': fund_code, 'period': period}
    
    response = requests.get(url, params=params)
    data = response.json()
    
    if 'error' in data:
        raise Exception(data['error'])
    
    return data

def analyze_fund(fund_code, period='year'):
    """åˆ†æåŸºé‡‘è¡¨ç°"""
    # è·å–æ•°æ®
    data = fetch_fund_trend(fund_code, period)
    
    # è½¬æ¢ä¸º DataFrame
    df = pd.DataFrame(data['data'])
    df['date'] = pd.to_datetime(df['date'])
    df.set_index('date', inplace=True)
    
    # è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
    first_value = df['value'].iloc[0]
    last_value = df['value'].iloc[-1]
    max_value = df['value'].max()
    min_value = df['value'].min()
    
    return_rate = (last_value - first_value) / first_value * 100
    volatility = df['value'].std()
    
    print(f"åŸºé‡‘ä»£ç : {data['code']}")
    print(f"åŸºé‡‘åç§°: {data['name']}")
    print(f"æŸ¥è¯¢å‘¨æœŸ: {period}")
    print(f"æ•°æ®ç‚¹æ•°: {len(df)}")
    print(f"-" * 50)
    print(f"èµ·å§‹å‡€å€¼: {first_value:.4f}")
    print(f"æœ€æ–°å‡€å€¼: {last_value:.4f}")
    print(f"æœ€é«˜å‡€å€¼: {max_value:.4f}")
    print(f"æœ€ä½å‡€å€¼: {min_value:.4f}")
    print(f"æ”¶ç›Šç‡: {return_rate:.2f}%")
    print(f"æ³¢åŠ¨ç‡: {volatility:.4f}")
    
    # ç»˜å›¾
    plt.figure(figsize=(12, 6))
    plt.plot(df.index, df['value'], linewidth=2, label='å‡€å€¼')
    plt.axhline(y=first_value, color='r', linestyle='--', 
                linewidth=1, alpha=0.5, label='èµ·å§‹å‡€å€¼')
    plt.fill_between(df.index, df['value'], first_value, 
                     where=(df['value'] >= first_value), 
                     alpha=0.3, color='green', label='ç›ˆåˆ©åŒºåŸŸ')
    plt.fill_between(df.index, df['value'], first_value, 
                     where=(df['value'] < first_value), 
                     alpha=0.3, color='red', label='äºæŸåŒºåŸŸ')
    
    plt.title(f"{data['name']} ({data['code']}) - å‡€å€¼èµ°åŠ¿", fontsize=14)
    plt.xlabel('æ—¥æœŸ', fontsize=12)
    plt.ylabel('å•ä½å‡€å€¼', fontsize=12)
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()
    
    return df

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    df = analyze_fund('001186', 'year')
```

---

## ğŸ”„ å¯¹æ¯”å¤šä¸ªåŸºé‡‘

```python
import requests
import matplotlib.pyplot as plt

def compare_funds(fund_codes, period='quarter'):
    """å¯¹æ¯”å¤šä¸ªåŸºé‡‘çš„è¡¨ç°"""
    plt.figure(figsize=(14, 7))
    
    for fund_code in fund_codes:
        # è·å–æ•°æ®
        response = requests.get(
            'http://localhost:8080/api/fund/trend',
            params={'code': fund_code, 'period': period}
        )
        data = response.json()
        
        if 'error' in data:
            print(f"é”™è¯¯: {fund_code} - {data['error']}")
            continue
        
        # å½’ä¸€åŒ–å¤„ç†(ä»¥ç¬¬ä¸€ä¸ªæ•°æ®ç‚¹ä¸ºåŸºå‡†)
        dates = [item['date'] for item in data['data']]
        values = [item['value'] for item in data['data']]
        base_value = values[0]
        normalized_values = [(v / base_value - 1) * 100 for v in values]
        
        # ç»˜åˆ¶æ›²çº¿
        plt.plot(dates, normalized_values, label=data['name'], linewidth=2)
    
    plt.title(f'åŸºé‡‘æ”¶ç›Šç‡å¯¹æ¯” - {period}', fontsize=14)
    plt.xlabel('æ—¥æœŸ', fontsize=12)
    plt.ylabel('æ”¶ç›Šç‡ (%)', fontsize=12)
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.axhline(y=0, color='black', linestyle='-', linewidth=0.5)
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()

# å¯¹æ¯”å¤šä¸ªåŸºé‡‘
compare_funds(['001186', '110022', '320007'], period='year')
```

---

## ğŸ“ˆ è®¡ç®—æŠ€æœ¯æŒ‡æ ‡

```python
import requests
import pandas as pd
import numpy as np

def calculate_indicators(fund_code, period='year'):
    """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡"""
    # è·å–æ•°æ®
    response = requests.get(
        'http://localhost:8080/api/fund/trend',
        params={'code': fund_code, 'period': period}
    )
    data = response.json()
    
    # è½¬æ¢ä¸º DataFrame
    df = pd.DataFrame(data['data'])
    df['date'] = pd.to_datetime(df['date'])
    
    # è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
    df['MA5'] = df['value'].rolling(window=5).mean()
    df['MA10'] = df['value'].rolling(window=10).mean()
    df['MA20'] = df['value'].rolling(window=20).mean()
    
    # è®¡ç®—æ³¢åŠ¨ç‡
    df['returns'] = df['value'].pct_change()
    df['volatility'] = df['returns'].rolling(window=20).std() * np.sqrt(252)
    
    # è®¡ç®—æœ€å¤§å›æ’¤
    df['cummax'] = df['value'].cummax()
    df['drawdown'] = (df['value'] - df['cummax']) / df['cummax']
    
    print(f"åŸºé‡‘: {data['name']}")
    print(f"\næœ€å¤§å›æ’¤: {df['drawdown'].min():.2%}")
    print(f"å¹³å‡æ³¢åŠ¨ç‡: {df['volatility'].mean():.2%}")
    
    return df

# ä½¿ç”¨ç¤ºä¾‹
df = calculate_indicators('001186', 'year')
print(df.tail())
```

---

## ğŸ”” å®šæ—¶ç›‘æ§ç¤ºä¾‹

```python
import requests
import time
from datetime import datetime

def monitor_fund(fund_code, threshold=2.0):
    """ç›‘æ§åŸºé‡‘æ¶¨è·Œå¹…,è¶…è¿‡é˜ˆå€¼æ—¶æé†’"""
    print(f"å¼€å§‹ç›‘æ§åŸºé‡‘ {fund_code}, é˜ˆå€¼: Â±{threshold}%")
    
    while True:
        try:
            # è·å–æœ€è¿‘ä¸€å‘¨æ•°æ®
            response = requests.get(
                'http://localhost:8080/api/fund/trend',
                params={'code': fund_code, 'period': 'week'}
            )
            data = response.json()
            
            if 'error' not in data and len(data['data']) >= 2:
                # è®¡ç®—ä»Šæ—¥æ¶¨è·Œå¹…
                yesterday = data['data'][-2]['value']
                today = data['data'][-1]['value']
                change = (today - yesterday) / yesterday * 100
                
                timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                print(f"[{timestamp}] {data['name']}: {today:.4f} ({change:+.2f}%)")
                
                # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
                if abs(change) >= threshold:
                    print(f"âš ï¸  è­¦å‘Š: æ¶¨è·Œå¹…è¶…è¿‡é˜ˆå€¼! å½“å‰: {change:+.2f}%")
            
        except Exception as e:
            print(f"é”™è¯¯: {e}")
        
        # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        time.sleep(300)

# ç›‘æ§åŸºé‡‘
monitor_fund('001186', threshold=2.0)
```

---

## ğŸ“Š ç”ŸæˆæŠ¥å‘Š

```python
import requests
from datetime import datetime

def generate_report(fund_codes):
    """ç”ŸæˆåŸºé‡‘å¯¹æ¯”æŠ¥å‘Š"""
    print("=" * 80)
    print(f"åŸºé‡‘åˆ†ææŠ¥å‘Š - {datetime.now().strftime('%Y-%m-%d')}")
    print("=" * 80)
    
    periods = ['week', 'month', 'quarter', 'year']
    period_names = {'week': 'è¿‘1å‘¨', 'month': 'è¿‘1æœˆ', 
                    'quarter': 'è¿‘1å­£', 'year': 'è¿‘1å¹´'}
    
    for fund_code in fund_codes:
        print(f"\nåŸºé‡‘ä»£ç : {fund_code}")
        
        returns = {}
        for period in periods:
            try:
                response = requests.get(
                    'http://localhost:8080/api/fund/trend',
                    params={'code': fund_code, 'period': period}
                )
                data = response.json()
                
                if 'error' not in data and len(data['data']) >= 2:
                    first = data['data'][0]['value']
                    last = data['data'][-1]['value']
                    ret = (last - first) / first * 100
                    returns[period] = ret
                    
                    if period == 'year':
                        print(f"åŸºé‡‘åç§°: {data['name']}")
                        
            except Exception as e:
                returns[period] = None
        
        print("-" * 40)
        for period in periods:
            ret = returns.get(period)
            if ret is not None:
                color = '+' if ret >= 0 else ''
                print(f"{period_names[period]}: {color}{ret:.2f}%")
            else:
                print(f"{period_names[period]}: N/A")
    
    print("\n" + "=" * 80)

# ç”ŸæˆæŠ¥å‘Š
generate_report(['001186', '110022', '320007'])
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **æ•°æ®ç¼“å­˜**: é¿å…é¢‘ç¹è¯·æ±‚,å»ºè®®ç¼“å­˜æ•°æ®
2. **é”™è¯¯å¤„ç†**: æ·»åŠ é‡è¯•æœºåˆ¶å’Œè¶…æ—¶å¤„ç†
3. **æ•°æ®éªŒè¯**: æ£€æŸ¥è¿”å›æ•°æ®çš„å®Œæ•´æ€§
4. **æ€§èƒ½ä¼˜åŒ–**: `all` å‘¨æœŸæ•°æ®é‡å¤§,è°¨æ…ä½¿ç”¨
5. **äº¤æ˜“æ—¶é—´**: åŸºé‡‘å‡€å€¼é€šå¸¸åœ¨äº¤æ˜“æ—¥æ”¶ç›˜åæ›´æ–°

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [APIæ¥å£æ–‡æ¡£](./èµ°åŠ¿æ¥å£æ–‡æ¡£.md)
- [æ•°æ®è¯´æ˜æ–‡æ¡£](./APIè¯´æ˜.md)
- [é¡¹ç›®README](../README.md)
