# 基金查询API - 功能总览

## 📁 项目结构

```
fund/
├── main.go                          # 程序入口
├── go.mod                           # Go模块配置
├── test_api.sh                      # API测试脚本
├── model/                           # 数据模型层
│   └── fund.go                      # 基金数据结构
├── service/                         # 业务逻辑层
│   └── fund_service.go              # 基金服务实现
├── handler/                         # HTTP处理层
│   └── fund_handler.go              # 请求处理器
├── router/                          # 路由层
│   └── router.go                    # 路由配置
├── middleware/                      # 中间件层
│   └── cors.go                      # CORS中间件
├── docs/                            # 文档目录
│   ├── API说明.md                   # 东方财富接口说明
│   ├── 走势接口文档.md              # 走势API文档
│   └── 使用示例.md                  # 实际使用示例
└── README.md                        # 项目说明
```

---

## 🚀 快速开始

### 启动服务

```bash
cd /Users/hisen/go/src/fund
go run main.go
```

服务启动在: `http://localhost:8080`

### 测试接口

```bash
# 运行完整测试
./test_api.sh

# 或手动测试
curl "http://localhost:8080/api/fund/detail?code=001186"
curl "http://localhost:8080/api/fund/trend?code=001186&period=month"
```

---

## 📡 API接口列表

### 1. 获取基金详情

**用途**: 获取基金的汇总信息,包括当前净值、实时估值、各期收益率等。

```bash
GET /api/fund/detail?code=001186
```

**返回数据**:
- 基金基本信息(代码、名称)
- 当前净值和实时估值
- 日/周/月/季/半年/年收益率
- 成立以来总收益率

**适用场景**:
- 基金概览页面
- 基金筛选列表
- 实时行情展示

---

### 2. 获取基金走势 ⭐ 新功能

**用途**: 获取基金在指定时间周期内的净值历史数据,用于绘制走势图。

```bash
GET /api/fund/trend?code=001186&period=month
```

**支持的周期**:
| 参数值 | 说明 | 数据范围 |
|--------|------|----------|
| `week` | 最近一周 | 近7天 |
| `month` | 最近一个月 | 近30天 |
| `quarter` | 最近一个季度 | 近3个月 |
| `half_year` | 最近半年 | 近6个月 |
| `year` | 最近一年 | 近12个月 |
| `three_years` | 最近三年 | 近36个月 |
| `all` | 全部历史 | 成立以来 |

**返回数据格式**:
```json
{
  "code": "001186",
  "name": "富国文体健康股票A",
  "period": "month",
  "data": [
    {"date": "2026-01-03", "value": 1.2345},
    {"date": "2026-01-06", "value": 1.2380}
  ]
}
```

**适用场景**:
- 绘制净值曲线图
- 收益率计算
- 历史表现分析
- 技术指标计算
- 多基金对比

---

### 3. 健康检查

```bash
GET /health
```

**用途**: 检查服务是否正常运行。

---

## 💡 使用场景示例

### 场景1: 基金详情页

```
1. 调用 /api/fund/detail 获取基金基本信息
2. 调用 /api/fund/trend?period=year 获取年度走势
3. 展示基金名称、当前净值、收益率
4. 绘制年度净值曲线图
```

### 场景2: 基金对比工具

```
1. 对多个基金调用 /api/fund/trend?period=quarter
2. 归一化处理所有基金数据(以起始点为100%)
3. 在同一图表中绘制多条曲线
4. 展示收益率排名
```

### 场景3: 定时监控

```
1. 定时调用 /api/fund/trend?period=week
2. 计算最近涨跌幅
3. 当涨跌幅超过阈值时发送提醒
4. 记录历史数据用于分析
```

### 场景4: 数据分析

```
1. 调用 /api/fund/trend?period=all 获取全部历史
2. 计算移动平均线(MA5/MA10/MA20)
3. 计算最大回撤
4. 计算波动率和夏普比率
5. 生成分析报告
```

---

## 📊 数据特点

### 数据来源

- **基金详情**: 东方财富网 `fund.eastmoney.com`
  - 历史净值数据
  - 收益率统计
  - 持仓信息
  
- **实时估值**: 天天基金网 `fundgz.1234567.com.cn`
  - 实时净值估算
  - 盘中涨跌幅
  - 更新时间

### 数据更新频率

- **净值数据**: 每个交易日收盘后更新(通常晚上8-9点)
- **实时估值**: 交易日9:30-15:00期间实时更新
- **周末节假日**: 无新数据

### 数据完整性

- 所有交易日都有数据点
- 非交易日没有数据(周末、节假日)
- 新成立基金数据从成立日开始

---

## 🎨 前端集成建议

### 图表库推荐

1. **ECharts** (推荐)
   - 功能强大,图表类型丰富
   - 支持移动端
   - 中文文档完善

2. **Chart.js**
   - 轻量级,易上手
   - 响应式设计
   - 动画效果好

3. **D3.js**
   - 高度可定制
   - 适合复杂可视化
   - 学习曲线较陡

### UI框架集成

```javascript
// React 示例
import { useEffect, useState } from 'react';
import * as echarts from 'echarts';

function FundChart({ fundCode, period }) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    fetch(`http://localhost:8080/api/fund/trend?code=${fundCode}&period=${period}`)
      .then(res => res.json())
      .then(data => {
        setData(data);
        renderChart(data);
      });
  }, [fundCode, period]);
  
  const renderChart = (data) => {
    const chart = echarts.init(document.getElementById('chart'));
    // ... 配置图表
  };
  
  return <div id="chart" style={{ width: '100%', height: '400px' }} />;
}
```

---

## 🔧 扩展建议

### 已实现功能 ✅

- [x] 基金详情查询
- [x] 实时估值获取
- [x] 多周期走势数据
- [x] CORS跨域支持
- [x] 参数验证
- [x] 错误处理

### 可扩展功能 📋

- [ ] 基金搜索(按名称/代码)
- [ ] 基金排行榜(按收益率/规模)
- [ ] 基金对比接口(一次返回多个基金)
- [ ] 数据缓存(Redis)
- [ ] 限流保护
- [ ] API密钥认证
- [ ] WebSocket实时推送
- [ ] 数据导出(CSV/Excel)
- [ ] 历史数据持久化
- [ ] 基金经理详情
- [ ] 持仓股票分析

---

## 📝 开发规范

### 代码分层

```
请求流程: HTTP请求 → Router → Middleware → Handler → Service → 外部API

1. Model层: 纯数据结构定义
2. Service层: 业务逻辑,数据获取和处理
3. Handler层: HTTP请求处理,参数验证
4. Router层: 路由注册和管理
5. Middleware层: 通用中间件(CORS、日志等)
```

### 命名规范

- 文件名: 小写+下划线 `fund_service.go`
- 结构体: 大驼峰 `FundDetail`
- 函数: 大驼峰(导出) `GetFundDetail`
- 变量: 小驼峰 `fundCode`

### 错误处理

```go
// 使用明确的错误信息
if fundCode == "" {
    return nil, fmt.Errorf("基金代码不能为空")
}

// 包装底层错误
if err != nil {
    return nil, fmt.Errorf("获取数据失败: %v", err)
}
```

---

## 📚 文档索引

- [README.md](../README.md) - 项目总览
- [API说明.md](./API说明.md) - 数据源接口详解
- [走势接口文档.md](./走势接口文档.md) - 走势API完整文档
- [使用示例.md](./使用示例.md) - 实际使用代码示例

---

## 🤝 贡献指南

### 添加新功能

1. 在 `model/` 中定义数据结构
2. 在 `service/` 中实现业务逻辑
3. 在 `handler/` 中添加HTTP处理
4. 在 `router/` 中注册路由
5. 编写文档和测试

### 代码提交

1. 保持代码整洁
2. 添加适当注释
3. 更新相关文档
4. 测试功能正常

---

## 📞 联系方式

如有问题或建议,欢迎提Issue或PR。

---

**最后更新**: 2026-02-02
